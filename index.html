<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Virohan's Sky V5</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky-top: #a1c4fd;
            --sky-bottom: #c2e9fb;
            --text-color: #333;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, var(--sky-top) 0%, var(--sky-bottom) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            /* Prevent bouncing on iOS */
            overscroll-behavior: none;
        }

        /* --- SOUND BUTTON --- */
        .sound-btn {
            position: absolute;
            top: 20px; right: 20px;
            background: rgba(255,255,255,0.5);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            z-index: 50;
            font-size: 14px;
            font-weight: bold;
            display: flex; align-items: center; gap: 5px;
            backdrop-filter: blur(4px);
        }

        /* --- CLOUDS --- */
        .cloud-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .cloud {
            position: absolute;
            fill: white;
            opacity: 0.8;
            filter: drop-shadow(0px 2px 5px rgba(255,255,255,0.3));
            animation: moveClouds linear infinite;
        }

        @keyframes moveClouds {
            from { transform: translateX(-300px); }
            to { transform: translateX(120vw); }
        }

        /* --- HEADER --- */
        header {
            text-align: center;
            padding-top: 60px;
            padding-bottom: 20px;
            position: relative;
            z-index: 10;
        }

        .logo {
            position: absolute;
            top: 15px; left: 20px;
            width: 90px; height: auto;
            z-index: 20;
        }

        h1 {
            color: #d63031;
            font-size: 2rem; margin: 0;
            text-shadow: 2px 2px 0px rgba(255,255,255,0.9);
        }

        .subtitle { color: #555; font-size: 0.9rem; margin-top: 5px; }

        .fly-btn {
            background: white; color: #0984e3; border: none;
            padding: 12px 30px; border-radius: 30px;
            font-weight: 700; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 15px; font-size: 1rem;
        }
        .fly-btn:active { transform: scale(0.95); }

        /* --- THE BOARD (ZIG ZAG LAYOUT) --- */
        #sky-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start; /* Align to top so we can push some down */
            gap: 40px; /* Space between kites horizontally */
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 5;
            padding-bottom: 150px; /* Extra space at bottom for long strings */
        }

        /* --- KITE WRAPPER --- */
        .kite-wrapper {
            position: relative;
            width: 140px;
            height: 300px; /* Tall to hold the string */
            animation: bobbing 5s ease-in-out infinite;
            cursor: pointer;
            /* border: 1px solid red; Debugging */
        }

        /* THE ZIG ZAG MAGIC: Push every 2nd kite down */
        .kite-wrapper:nth-child(even) {
            margin-top: 120px; /* Pushes the even kites down */
        }

        @keyframes bobbing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* --- KITE BODY (No Cross Sticks) --- */
        .kite-body {
            width: 100px; height: 100px;
            margin: 0 auto;
            transform: rotate(45deg);
            border: 2px solid rgba(255,255,255,0.6);
            box-shadow: 10px 10px 20px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px; /* Slight soft corner */
        }

        .kite-text {
            transform: rotate(-45deg);
            text-align: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            line-height: 1.2;
            z-index: 3;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* --- STRING & BOWS --- */
        .kite-tail-svg {
            position: absolute;
            top: 90px; /* Attached to bottom tip */
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 220px;
            z-index: 1;
            pointer-events: none;
            overflow: visible;
        }

        .string-path {
            fill: none; stroke: #fff; stroke-width: 1.5;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.2));
            animation: tailWiggle 4s ease-in-out infinite alternate;
            transform-origin: 50% 0;
        }
        
        .bow-shape {
            fill: white;
            animation: tailWiggle 4s ease-in-out infinite alternate;
            transform-origin: 50% -50px;
        }

        @keyframes tailWiggle {
            from { transform: rotate(-4deg); }
            to { transform: rotate(4deg); }
        }

        /* --- DELETE BTN --- */
        .delete-btn {
            position: absolute;
            top: -10px; right: 10px;
            width: 24px; height: 24px;
            background: #ff4757; color: white;
            border-radius: 50%;
            text-align: center; line-height: 24px;
            font-size: 14px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* --- MODALS --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 100;
            align-items: center; justify-content: center;
            backdrop-filter: blur(8px);
        }

        .modal-card {
            background: rgba(255, 255, 255, 0.95);
            width: 85%; max-width: 380px;
            border-radius: 20px; padding: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        input, textarea {
            width: 100%; padding: 12px; margin-bottom: 12px;
            border: 1px solid #ddd; border-radius: 12px;
            box-sizing: border-box; font-family: inherit; font-size: 16px;
        }

        .color-options { display: flex; justify-content: center; gap: 12px; margin: 15px 0; }
        .color-circle {
            width: 35px; height: 35px; border-radius: 50%;
            cursor: pointer; border: 3px solid transparent; transition: 0.2s;
        }
        .color-circle.selected { border-color: #333; transform: scale(1.1); }

        .action-btn {
            background: #d63031; color: white; border: none;
            width: 100%; padding: 15px; border-radius: 12px;
            font-weight: bold; cursor: pointer; font-size: 1rem;
        }
    </style>
</head>
<body>

    <div class="sound-btn" onclick="toggleWind()">
        <span id="sound-icon">üîá</span> Enable Sound
    </div>

    <div id="clouds" class="cloud-container"></div>

    <header>
        <img src="https://i.imgur.com/87mstoS.png" alt="Virohan Logo" class="logo">
        <h1>Virohan's Sky</h1>
        <p class="subtitle">Send a message into the breeze</p>
        <button class="fly-btn" onclick="openCreateModal()">+ Fly a Kite</button>
    </header>

    <div id="sky-board"></div>

    <div id="create-modal" class="modal-overlay" onclick="closeModals(event)">
        <div class="modal-card">
            <h3 style="margin-top:0; color:#d63031;">New Kite</h3>
            <div style="display:flex; gap:10px;">
                <input type="text" id="input-from" placeholder="From">
                <input type="text" id="input-to" placeholder="To">
            </div>
            <textarea id="input-msg" rows="3" placeholder="Your message..."></textarea>
            <div class="color-options" id="color-picker"></div>
            <button class="action-btn" onclick="releaseKite()">Release Kite ü™Å</button>
        </div>
    </div>

    <div id="view-modal" class="modal-overlay" onclick="closeModals(event)">
        <div class="modal-card">
            <p style="font-size: 0.8rem; color:#888; letter-spacing: 1px;">FOR</p>
            <h2 id="view-to" style="color:#d63031; margin: 5px 0 20px 0;">Recipient</h2>
            <p id="view-msg" style="font-style:italic; font-size:1.3rem; color:#333; margin-bottom:20px;">Message</p>
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            <p style="color:#888;">With love from <b id="view-from" style="color:#0984e3;">Sender</b></p>
            <button class="action-btn" style="background:#0984e3; margin-top:10px;" onclick="forceClose()">Close</button>
        </div>
    </div>

    <script>
        const colors = [
            { bg: '#ff7675' }, { bg: '#fdcb6e' }, { bg: '#74b9ff' }, 
            { bg: '#55efc4' }, { bg: '#a29bfe' }, { bg: '#ff9f43' }
        ];
        let selectedColor = colors[0].bg;

        // --- WIND SOUND ENGINE (Web Audio API) ---
        let audioCtx;
        let windNode;
        let isPlaying = false;

        function toggleWind() {
            const btn = document.getElementById('sound-icon');
            
            if (!audioCtx) {
                // Create Audio Context on first click
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }

            if (isPlaying) {
                audioCtx.suspend();
                btn.innerText = "üîá";
                isPlaying = false;
            } else {
                audioCtx.resume();
                if(!windNode) createWind();
                btn.innerText = "üîä";
                isPlaying = true;
            }
        }

        function createWind() {
            // White Noise Generator
            const bufferSize = 2 * audioCtx.sampleRate;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            const whiteNoise = audioCtx.createBufferSource();
            whiteNoise.buffer = buffer;
            whiteNoise.loop = true;

            // Filter to make it sound like Wind (Lowpass)
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 400; // Deep wind sound
            
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 0.05; // Soft volume

            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            whiteNoise.start(0);
            windNode = whiteNoise;
            
            // Vary the wind pitch slightly over time
            setInterval(() => {
                filter.frequency.rampToValueAtTime(300 + Math.random() * 200, audioCtx.currentTime + 2);
            }, 3000);
        }

        // --- APP LOGIC ---
        document.addEventListener("DOMContentLoaded", () => {
            generateClouds();
            initColorPicker();
            loadKites();
        });

        function generateClouds() {
            const container = document.getElementById('clouds');
            const svgs = [
                `<svg viewBox="0 0 24 24"><path d="M18.5,12c0-1.7-1.4-3-3-3c-0.6,0-1.1,0.2-1.6,0.5C13.2,7.3,10.8,6,8,6C4.1,6,1,9.1,1,13c0,3.9,3.1,7,7,7h10.5c3,0,5.5-2.5,5.5-5.5S21.5,12,18.5,12z"/></svg>`,
                `<svg viewBox="0 0 24 24"><path d="M19.5,13c0-1.5-1.1-2.8-2.6-3c-0.3-2.1-2.1-3.8-4.4-3.8c-1.7,0-3.2,1-3.9,2.4C8.2,8.2,7.6,8,7,8C4.2,8,2,10.2,2,13c0,2.8,2.2,5,5,5h12.5c2.8,0,5-2.2,5-5S22.3,13,19.5,13z"/></svg>`
            ];

            for(let i=0; i<8; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                cloud.innerHTML = svgs[Math.floor(Math.random() * svgs.length)];
                const size = 100 + Math.random() * 180;
                cloud.style.width = size + 'px';
                cloud.style.height = size + 'px';
                cloud.style.top = (Math.random() * 80) + '%';
                cloud.style.animationDuration = (30 + Math.random() * 40) + 's';
                cloud.style.animationDelay = (Math.random() * -30) + 's';
                container.appendChild(cloud);
            }
        }

        function initColorPicker() {
            const container = document.getElementById('color-picker');
            colors.forEach((c, idx) => {
                const circle = document.createElement('div');
                circle.className = 'color-circle' + (idx===0?' selected':'');
                circle.style.backgroundColor = c.bg;
                circle.onclick = () => {
                    document.querySelectorAll('.color-circle').forEach(el => el.classList.remove('selected'));
                    circle.classList.add('selected');
                    selectedColor = c.bg;
                };
                container.appendChild(circle);
            });
        }

        function openCreateModal() { 
            document.getElementById('create-modal').style.display = 'flex'; 
        }
        function forceClose() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
        function closeModals(e) { if (e.target.classList.contains('modal-overlay')) forceClose(); }

        function releaseKite() {
            const from = document.getElementById('input-from').value;
            const to = document.getElementById('input-to').value;
            const msg = document.getElementById('input-msg').value;
            if (!from || !to || !msg) return alert("Please fill all fields!");

            const kite = { id: Date.now(), from, to, msg, color: selectedColor };
            saveKite(kite);
            renderKite(kite);
            forceClose();
            
            document.getElementById('input-from').value = '';
            document.getElementById('input-to').value = '';
            document.getElementById('input-msg').value = '';
        }

        function renderKite(kite) {
            const sky = document.getElementById('sky-board');
            const wrapper = document.createElement('div');
            wrapper.className = 'kite-wrapper';
            wrapper.id = 'kite-' + kite.id;
            wrapper.onclick = (e) => { if(!e.target.classList.contains('delete-btn')) viewKite(kite); };

            // Clean string SVG
            const stringSVG = `
            <svg class="kite-tail-svg" viewBox="0 0 100 220">
                <path class="string-path" d="M50,0 Q50,60 50,120 T50,220" />
                <g class="bow-shape">
                     <path d="M42,50 L58,50 L58,56 L42,56 Z" fill="white" transform="rotate(-15 50 53)"/>
                     <circle cx="50" cy="53" r="1.5" fill="#ddd"/>
                </g>
                <g class="bow-shape">
                     <path d="M42,110 L58,110 L58,116 L42,116 Z" fill="white" transform="rotate(10 50 113)"/>
                     <circle cx="50" cy="113" r="1.5" fill="#ddd"/>
                </g>
                <g class="bow-shape">
                     <path d="M42,170 L58,170 L58,176 L42,176 Z" fill="white" transform="rotate(-5 50 173)"/>
                     <circle cx="50" cy="173" r="1.5" fill="#ddd"/>
                </g>
            </svg>
            `;

            wrapper.innerHTML = `
                <div class="delete-btn" onclick="deleteKite(${kite.id})">√ó</div>
                <div class="kite-body" style="background-color: ${kite.color};">
                    <div class="kite-text">
                        <small style="opacity:0.9; font-size:0.6rem; text-transform:uppercase;">To</small><br>
                        ${kite.to.substring(0, 10)}
                    </div>
                </div>
                ${stringSVG}
            `;
            sky.appendChild(wrapper);
        }

        function viewKite(kite) {
            document.getElementById('view-to').innerText = kite.to;
            document.getElementById('view-msg').innerText = `"${kite.msg}"`;
            document.getElementById('view-from').innerText = kite.from;
            document.getElementById('view-modal').style.display = 'flex';
        }

        function saveKite(kite) {
            let kites = JSON.parse(localStorage.getItem('virohanSkyV5')) || [];
            kites.push(kite);
            localStorage.setItem('virohanSkyV5', JSON.stringify(kites));
        }

        function loadKites() {
            let kites = JSON.parse(localStorage.getItem('virohanSkyV5')) || [];
            kites.forEach(k => renderKite(k));
        }

        function deleteKite(id) {
            if(!confirm("Cut the string?")) return;
            document.getElementById('kite-' + id).remove();
            let kites = JSON.parse(localStorage.getItem('virohanSkyV5')) || [];
            kites = kites.filter(k => k.id !== id);
            localStorage.setItem('virohanSkyV5', JSON.stringify(kites));
        }
    </script>
</body>
</html>
